{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto mt-10">
    <h2 class="text-3xl font-bold text-red-600 mb-6">Dashboard - {{ user.user_name }}</h2>

     Buttons
    <div class="flex items-center mb-6 space-x-4">
        <form action="{{ url_for('generate_plan', user_id=user.id) }}" method="get" onsubmit="showLoadingOverlay()">
            <button type="submit"
                    class="bg-red-600 text-white px-6 py-3 rounded hover:bg-red-700 font-semibold">
                Generate Daily Workout & Meal Plan
            </button>
        </form>

        <form action="{{ url_for('generate_weekly_plan_route', user_id=user.id) }}" method="get"
              onsubmit="showLoadingOverlay()">
            <button type="submit"
                    class="bg-red-600 text-white px-6 py-3 rounded hover:bg-red-700 font-semibold">
                Generate Weekly Workout & Meal Plan
            </button>
        </form>
    </div>

    <div class="flex gap-4 mb-6">
  <a href="{{ url_for('generate_daily_meals', user_id=user.id) }}"
     class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded">
     Generate Daily Meals
  </a>
  <a href="{{ url_for('generate_daily_workouts', user_id=user.id) }}"
     class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded">
     Generate Daily Workouts
  </a>
</div>

    <div class="mb-6">
        <h3 class="font-bold">P = Proteins, C = Carbs, F = Fats</h3>
    </div>

    <!-- Daily Plans Section -->
    <h2 class="text-2xl font-bold text-black mb-4">Daily Plans</h2>
    {% if user.daily_plans %}
    {% for plan in user.daily_plans %}
    <div class="bg-white shadow rounded-lg p-6 mb-6 border-l-4 border-red-600">
        <h3 class="text-xl font-semibold text-black mb-3">
            Daily Meals Plan Generated on:
            {% if plan.created_at %}
            {{ plan.created_at.strftime("%Y-%m-%d") }},
            at {{ plan.created_at.strftime("%H:%M") }}
            {% else %}
            N/A
            <!--  {% endif %}-->
        </h3>

        <h4 class="font-bold text-red-600 mt-2">Meals</h4>
        <ul class="list-disc ml-6 font-bold">
  {% for meal in plan.data.get("meals", []) %}
    <li class="mb-2">
      <a href="{{ url_for('item_details',
                          item_type='meal',
                          plan_id=plan.id,
                          item_index=loop.index0) }}"
         class="flex items-center space-x-4 hover:bg-gray-50 p-2 rounded transition">
        <img src="{{ meal.image_url or url_for('static', filename='default_meal.jpg') }}"
             alt="{{ meal.name }}" title="{{ meal.name }}"
             class="w-20 h-20 object-cover rounded border border-gray-200 shrink-0">
        <div>
          <span class="text-red-600 block">
            {% if loop.index is odd %} Meal {{ (loop.index + 1)//2 }}:
            {% else %} Snack {{ loop.index//2 }}:
            {% endif %}
          </span>
          <span>{{ meal.name }}</span>
          <span class="text-sm text-gray-700 block">
            {{ meal.calories }} kcal | P: {{ meal.protein }} g | C: {{ meal.carbs }} g |
            F: {{ meal.fats or meal.fat }} g
          </span>
        </div>
      </a>
    </li>
  {% endfor %}
</ul>


        <h4 class="font-bold text-red-600 mt-2">Workouts</h4>
        <ul class="list-disc ml-6">
            {% for workout in plan.data.get("workouts", []) %}
            <li class="mb-2">
                <a href="{{ url_for('item_details',
                          item_type='meal',
                          plan_id=plan.id,
                          item_index=loop.index0) }}"
         class="flex items-center space-x-4 hover:bg-gray-50 p-2 rounded transition">
        <img src="{{ workout.image_url or url_for('static', filename='default_meal.jpg') }}"
             alt="{{ workout.name }}" title="{{ workout.name }}"
             class="w-20 h-20 object-cover rounded border border-gray-200 shrink-0">
                {{ workout.name }} ({{ workout.type }}) – {{ workout.duration }},
                Intensity: {{ workout.intensity }}, Instructions: {{ workout.instructions }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}
    {% else %}
    <p class="text-gray-700">No daily plan generated yet.</p>
    {% endif %}

    <!-- Weekly Plans Section -->
    <h2 class="text-2xl font-bold text-black mb-4">Weekly Plans</h2>
    {% if user.weekly_plans %}
    {% for plan in user.weekly_plans %}
    <div class="bg-white shadow rounded-lg p-6 mb-6 border-l-4 border-green-600">
        <h3 class="text-xl font-semibold text-black mb-3">
            Weekly Plan Generated on:
            {% if plan.created_at %}
            {{ plan.created_at.strftime("%Y-%m-%d") }}, at {{ plan.created_at.strftime("%H:%M") }}
            {% else %} N/A {% endif %}
        </h3>

        {% for day, details in plan.data.items() %}
        <div class="mb-4">
            <h4 class="text-lg font-bold text-red-600">{{ day }}</h4>

            {% if details.rest_day %}
            <p class="text-gray-700 font-bold">Rest Day</p>
            <p class="italic">{{ details.notes }}</p>
            {% else %}
            <h5 class="font-bold mt-2">Meals</h5>
            <ul class="list-disc ml-6 font-bold">
                {% for meal in details.meals %}
                <li class="mb-2">
                    {{ meal.name }} – Calories: {{ meal.calories }} kcal |
                    Proteins: {{ meal.protein }} g | Carbs: {{ meal.carbs }} g | Fats: {{ meal.fats or meal.fat }} g
                </li>
                {% endfor %}
            </ul>

            <h5 class="font-bold mt-2">Workouts</h5>
            <ul class="list-disc ml-6">
                {% for workout in details.workouts %}
                <li>
                    {{ workout.name }} ({{ workout.type }}) – {{ workout.duration }},
                    Instructions: {{ workout.Instructions }},
                    Sets: {{ workout.sets }}, Reps: {{ workout.reps }},
                    Rest: {{ workout.rest_between_sets }},
                    Intensity: {{ workout.intensity }}
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endfor %}
    {% else %}
    <p class="text-gray-700">No weekly plan generated yet.</p>
    {% endif %}
</div>
{% endblock %}
