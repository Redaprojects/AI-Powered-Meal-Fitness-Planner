"""
AI-Powered Fitness & Meal Planner Web App
--------------------------------------------------
This Flask application allows users to register with personal fitness information, plan workouts, track meals, and log daily progress.
It uses SQLAlchemy as the ORM and integrates an AI recommendation system for meal/workout suggestions (in later phases).

Main components:
- Flask routing and form handling
- SQLAlchemy models (User, Workout, WorkoutPlan, Meal, Log)
- SQLiteDataManager class for database abstraction (planned)
- Future AI integration to personalize meal/workout planning
"""

from flask import Flask, render_template, request, flash, redirect, url_for
from AI_workouts_meals.datamanager.models import db, User, Workout, WorkoutPlan, Meal, Log
from AI_workouts_meals.datamanager.sqlite_data_manager import SQLiteDataManager

# Initialize Flask app
app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///fitness_app.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
app.secret_key = 'your_secret_key_here'

# Initialize SQLAlchemy with app
db.init_app(app)

# Data manager instance (future AI logic can use this abstraction)
data_manager = SQLiteDataManager('fitness_app.db', app)

# Create all tables on first run
with app.app_context():
    db.create_all()

@app.route('/')
def home():
    """Render the home page."""
    return render_template('home.html')

@app.route('/add_user', methods=['GET', 'POST'])
def add_user():
    """
    Route for adding a new user.
    GET  -> Renders the user input form.
    POST -> Validates and adds the user to the database.
    """
    if request.method == 'POST':
        user_name = request.form.get('user_name')
        gender = request.form.get('gender')
        age = request.form.get('age')
        height = request.form.get('height')
        weight = request.form.get('weight')
        dietary_pref = request.form.get('dietary_pref')
        fitness_goal = request.form.get('fitness_goal')

        if not user_name or not gender or not age:
            flash("Username, gender, and age are required.", "error")
            return redirect(url_for('add_user'))

        try:
            age = int(age)
            height = float(height)
            weight = float(weight)
        except ValueError:
            flash("Please enter valid numeric values.", "error")
            return redirect(url_for('add_user'))

        new_user = User(
            user_name=user_name,
            gender=gender,
            age=age,
            height=height,
            weight=weight,
            dietary_pref=dietary_pref,
            fitness_goal=fitness_goal
        )

        db.session.add(new_user)
        db.session.commit()
        flash("User added successfully!", "success")
        return redirect(url_for('home'))

    return render_template('add_user.html')

# Add more routes here for workouts, meals, logs, plans, AI suggestions etc.

if __name__ == '__main__':
    app.run(debug=True)
